# Log Service

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ Go –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Prometheus –∏ Grafana.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: HTTP –∑–∞–ø—Ä–æ—Å—ã, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –æ—à–∏–±–∫–∏
- üìù **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏**: JSON-—Ñ–æ—Ä–º–∞—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏ –∏ —É—Ä–æ–≤–Ω—è–º–∏
- ü§ñ **AI-–∞–Ω–∞–ª–∏–∑**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ERROR/WARN –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ GigaChat (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏)
- üê≥ **Docker**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω
- üìà **Grafana**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- üîÑ **API endpoints**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤ –∏ —Å–∏–º—É–ª—è—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /generate-logs` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –ª–æ–≥–æ–≤
- `GET /simulate` - –°–∏–º—É–ª—è—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π
- `GET /metrics` - Prometheus –º–µ—Ç—Ä–∏–∫–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å AI-–æ—Ç–≤–µ—Ç–∞–º–∏
docker compose up
```

–°–µ—Ä–≤–∏—Å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ERROR/WARN –ª–æ–≥–∏ –∫–∞–∂–¥—ã–µ 8 —Å–µ–∫—É–Ω–¥**. –í—ã —Å—Ä–∞–∑—É —É–≤–∏–¥–∏—Ç–µ:

```
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üì§ [AI REQUEST] LOG ERROR 2025-12-07T11:16:39Z Failed to parse JSON payload
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí¨ [AI RESPONSE] –û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON –≤ –∑–∞–ø—Ä–æ—Å–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
docker compose down
```

## –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ docker-compose:

- **Log Service**: http://localhost:8080
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin)

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8080/health

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤
curl http://localhost:8080/generate-logs

# –°–∏–º—É–ª—è—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞
curl http://localhost:8080/simulate

# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
curl http://localhost:8080/metrics
```

## –ú–µ—Ç—Ä–∏–∫–∏

–°–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

- `http_requests_total` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `active_connections` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `processing_errors_total` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod download

# –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ
go run main.go

# –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
go build -o log-service
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `PORT` - –ü–æ—Ä—Ç –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 8080)
- `AGENT_LOG_ENDPOINT` - URL –≤–µ–±—Ö—É–∫–∞ –ò–ò-–∞–≥–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–∏—ë–º–∞ –ª–æ–≥–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `AGENT_METRIC_ENDPOINT` - URL –≤–µ–±—Ö—É–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus text exposition (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `AGENT_AUTH_TOKEN` - Bearer-—Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `AGENT_METRIC_INTERVAL` - –ß–∞—Å—Ç–æ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Ç—Ä–∏–∫, duration-—Ñ–æ—Ä–º–∞—Ç Go (–Ω–∞–ø—Ä–∏–º–µ—Ä `1m`, `5m`; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5m)
- `AUTO_LOG_INTERVAL` - –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è ERROR/WARN –ª–æ–≥–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è AI (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8s; –ø—É—Å—Ç–æ = –æ—Ç–∫–ª—é—á–µ–Ω–æ). –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 2-4 –ª–æ–≥–∞ –∫–∞–∂–¥—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è —á–∞—Å—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –º–æ–¥–µ–ª—å—é
- `FOUNDATION_API_URL` - –ë–∞–∑–æ–≤—ã–π URL GigaChat Foundation API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `https://foundation-models.api.cloud.ru/v1`)
- `FOUNDATION_MODEL` - –ú–æ–¥–µ–ª—å, –Ω–∞–ø—Ä–∏–º–µ—Ä `ai-sage/GigaChat3-10B-A1.8B`
- `FOUNDATION_API_KEY` - –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ Foundation API; –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ª–æ–≥–∏/–º–µ—Ç—Ä–∏–∫–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ —á–∞—Ç-–∑–∞–ø—Ä–æ—Å—ã

### –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –ò–ò-–∞–≥–µ–Ω—Ç–∞

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API:**
- –í Foundation API –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ ERROR, WARN** –∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (timeout, failed, denied, unauthorized)
- INFO/DEBUG –ª–æ–≥–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∞–Ω–æ–º–∞–ª–∏–π (–æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –Ω—É–ª–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)

**–§–æ—Ä–º–∞—Ç—ã:**
- –õ–æ–≥–∏: –∫–∞–∂–¥—ã–π –∫—Ä–∏—Ç–∏—á–Ω—ã–π –ª–æ–≥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ POST JSON –Ω–∞ `AGENT_LOG_ENDPOINT`. –§–æ—Ä–º–∞—Ç:
```json
{
	"timestamp": "2025-12-07T10:00:00Z",
	"level": "INFO",
	"message": "...",
	"service": "log-service"
}
```
- –ú–µ—Ç—Ä–∏–∫–∏: POST —Ç–µ–∫—Å—Ç–æ–≤—ã–π –¥–∞–º–ø –º–µ—Ç—Ä–∏–∫ Prometheus –Ω–∞ `AGENT_METRIC_ENDPOINT` —Å `Content-Type: text/plain; version=0.0.4` (–µ—Å–ª–∏ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω). –í Foundation API –º–µ—Ç—Ä–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö.
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `AGENT_AUTH_TOKEN`, –æ–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ `Authorization: Bearer <token>` –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ –æ—Ç–ø—Ä–∞–≤–æ–∫.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–µ—Ä–≤–∏—Å —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:
- HTTP —Å–µ—Ä–≤–µ—Ä —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏
- Prometheus –∫–ª–∏–µ–Ω—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫
- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–æ–Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
